## Cache

### Cache处理写操作

cache和主存不一致时，保存一致带方法

#### 写穿透（写直达）Write through

总是将数据写会内存和cache。性能不佳。解决方法：

##### 写缓冲write buffer 

写入cache同时写入buffer，buffer满了之后写入主存

#### 写返回Write back 

新值只写到cache，被改写的值才同时写到主存，所以需要一个dirty位标识

#### 写分配

当写直达且写失效时

**写分配（write allocate）：**先将要写人数据块从内存取入cache中，再写

**写不分配（no write allocate）：**直接在内存更新

### cache性能评估

#### 假设命中时间不是影响cache性能的重要因素

$$
CPU_{时间} = (CPU执行时间 + 访问储存停顿时间) \times 时钟周期 \\
$$

大多数写船头cache结构中，读和写的失效的代价是相同的，假设写缓冲的停顿可以忽略不计， 此时
$$
访问储存停顿时间 = \frac{访存操做数目}{程序} \times 写失效率 \times 写失效代价\\
访问储存停顿时间 = \frac{指令数目}{程序} \times \frac{失效次数}{指令数目}  \times 写失效代价
$$

#### 考虑命中和失效以及不同访问频度的影响

平均储存访问时间AMAT
$$
AMAT = 命中时间 + 失效率 \times 失效代价
$$

### 相联结构

#### 组相联和全相联

$$
数据块数目 = 组数(set)(把cache分成多少组) \times 路数(way)(几个路为一组)
$$

组数为1或者路数等于数据块数时，即为全相联

优缺点：通常可以降低失效率，但是会增加命中时间

#### 失效替换规则

**最近最少使用（Least Recently Used, LRU）**

### 多级cache

### 虚拟储存

